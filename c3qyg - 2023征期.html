<!doctype html>
<html lang=zh_CN>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <title>进出口税收政策速配器</title>
  <!-- 引入样式文件 -->
  <link rel=stylesheet href="./res/weui.css">



</head>

<body ontouchstart>

  <div class="page">
    <div class="weui-form"style="padding-top:15px;border:0px solid red;">
      <div class="weui-form__text-area" style="margin-bottom:2px;border:0px solid red;">
        
        <h3 style="padding-top: 10px;">启运港退税政策时间影响主题（2023年征期）</h3>

        <div class="weui-form__desc" style="text-align: left;font-size: 11pt;">⏩本测算工具由广州市南沙区税务局制作，测算结果仅供参考，请以相关文件及主管税务机关要求为准。</div>
      </div>
      <div class="weui-form__control-area" style="margin-top:5px;margin-bottom:5px;padding-top:10px;border:0px solid red;">
        <div class="weui-cells__group weui-cells__group_form">
          <span style="font-weight:bold;color:#26baff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;输入测算条件:</span>
          <div class="weui-cells">
            
            <label for="js_input1" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">①是否适用启运港退税政策</span></div>
              <div class="weui-cell__bd">
                <input id="js_input1" class="weui-input" placeholder="请选择是否" value="是" />
              </div>
            </label>

            <label for="js_input2" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">②企业类型</span></div>
              <div class="weui-cell__bd">
                <input id="js_input2" class="weui-input" placeholder="请选择" />
              </div>
            </label>
            

            <label for="js_input3" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">③启运日期</span>
                <!-- <div class="weui-cell__desc">副标题</div> -->
              </div>
              <div class="weui-cell__bd">
                <input id="js_input3" class="weui-input" placeholder="请选择日期" />
              </div>
            </label>

            <label for="js_input4" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">④启运与离境间隔天数</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input4" class="weui-input" placeholder="请输入数字" type="number" pattern="[0-9]*" />
              </div>
            </label>

            <label for="js_input5" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">⑤离境日期</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input5" class="weui-input" placeholder="点击自动计算 ⑤=③+④" readonly/>
              </div>
            </label>

            <label for="js_input6" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑥报关日期</span>
                <div class="weui-cell__desc">（报关单的</div>
                <div class="weui-cell__desc">“出口日期”）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input6" class="weui-input" placeholder="点击自动计算" readonly />
              </div>
            </label>

            <label for="js_input7" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">⑦报关与获取关单电子信息间隔天数</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input7" class="weui-input" placeholder="请输入数字" type="number" pattern="[0-9]*" />
              </div>
            </label>

            <label for="js_input8" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑧获取关单电子信息日期</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input8" class="weui-input" placeholder="点击自动计算 ⑧=⑥+⑦" readonly />
              </div>
            </label>

            <br/><span style="font-weight:bold;color:#26baff">&nbsp;&nbsp;&nbsp;输出测算结果:</span>
            <label for="js_input9" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑨增值税纳税申报所属期</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input9" class="weui-input" placeholder="自动获取 ⑨=⑥所在月份" readonly />
              </div>
            </label>

            <label for="js_input10" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑩出口退税申报所属期</span>
                <div class="weui-cell__desc">（单证信息齐全）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input10" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

            <label for="js_input11" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑪增值税纳税申报时限</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input11" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

            <label for="js_input12" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑫出口退税申报时限</span>
                <div class="weui-cell__desc">（最早）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input12" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

          </div>
        </div>
      </div>
      
      <div class="weui-form__tips-area">
        <p class="weui-form__tips" style="text-align: left;">
        ⏩本主题进出口税收政策速配器主要依据以下文件：《国家税务总局关于发布<启运港退（免）税管理办法（2018年12月28日修订）>的公告 》（总局公告2018年第66号）;《财政部 海关总署 税务总局关于完善启运港退税政策的通知》（ 财税〔2018〕5号）;《国家税务总局关于发布适用启运港退（免）税政策的运输企业及运输工具名单的公告》 （总局公告2015年第9号）;《国家税务总局关于发布<启运港退（免）税管理办法>的公告》 （总局公告2014年第52号）。如上述文件失效或变更，则本工具无效，请勿参考使用。
   <br/>⏩如对测算工具有相关问题或建议，请反馈至以下邮箱：ns440198@163.com。
   <br/>⏩填写说明：
        <br/>（1）第1栏，适用启运港退税政策请在第1栏勾选“是”，否则为“否”。启运港退税需符合适用条件并按照《启运港退（免）税管理办法》（国家税务总局公告2018年第66号）进行申报；										
        <br/>（2）第2栏，请按照企业出口退（免）税备案的企业类型填写，包括“生产企业”、“外贸企业”类型；											
        <br/>（3）第3栏“启运日期”为在启运港（地）装船当天日期；					（4）第4栏“启运与离境间隔天数”为从启运港（地）装船到抵达离境港之间的运输天数，请填写整数；										
        <br/>（5）第5栏“离境日期”为到达离境港当日，离境日期=启运日期+离境间隔天数；
        <br/>（6）第6栏“报关日期”：本工具预设适用启运港退税政策的企业，报关日期为启运日期，不适用启运港退税政策的企业，报关日期为离境日期，预设条件为放行日期即报关当日；
        <br/>（7）第7栏“报关日与获取关单电子信息日间隔天数”为报关日期与企业获取关单电子信息日期之间的间隔天数；
        <br/>（8）第8栏“获取关单电子信息日期”为企业获取海关报关单电子信息当日，获取关单电子信息日期=报关日期+报关日与获取关单电子信息日；
        <br/>（9）第9栏“增值税纳税申报所属期”：企业可进行申报的所属期最早为报关当月，如遇法定节假日或税务机关申报期限调整，请以实际情况和相关规定为准。本工具预设条件为企业报关时已满足收入确认相关条件；
        <br/>（10）第10栏，测算“单证信息齐全出口货物销售额出口退税申报所属期”信息，如第8栏(获取关单电子信息日期)与第6栏(报关日期)为同一个月，则为第9栏所填的所属期；如第8栏较第6栏属于跨月，则分为：
        <br/>&nbsp;&nbsp;&nbsp;&nbsp;①如果第8栏(获取关单电子信息日期)在当月出口退税申报期限内（外贸企业则为当月月内），则为第8栏所填月份减1个月；
        <br/>&nbsp;&nbsp;&nbsp;&nbsp;②如果第8栏(获取关单电子信息日期)在当月出口退税申报期限外，则为第8栏所填月份。因受跨年度征期影响，本工具暂未将跨年后申报需在上一年度最后一个月所属期反映的情形纳入计算范围；
        <br/>（11）第11栏“增值税纳税申报时限”：生产企业和外贸企业增值税纳税申报时限相同，计算结果引用《2023年国家税务总局广东省税务局征期日历》，仅供参考，广东以外地区及2023年后申报时限以当地征期日历为准；
        <br/>（12）第12栏“出口退税申报时限”：经主管税务机关批准的外贸企业，在增值税纳税申报期以外的其他时间也可办理出口退税申报；生产企业出口退税申报时限与增值税纳税申报时限相同。

        </p>
      </div>

      <div class="weui-form__extra-area" style="margin-top:5px;border:0px solid red;">
        <div class="weui-footer">
          <p class="weui-footer__links">
            <a href="javascript:history.back()" class="weui-footer__link">返回上一页</a>
          </p>
          <p class="weui-footer__text">Copyright © 2023 广州南沙税务</p>
        </div>
      </div>
    </div>
  </div>
  <!--<script type="text/javascript" src="./zepto.js"></script> -->
  <script type="text/javascript" src="./res/moment.min.js"></script>
  <script type="text/javascript" src="https://res.wx.qq.com/t/wx_fed/cdn_libs/res/weui/1.2.8/weui.min.js"></script>





  <script>
    //出口退税申报期限 -- 生产企业
    var array1 = new Array();
      array1[0] = "Null";
      array1[1] = "2023-01-16";
      array1[2] = "2023-02-15";
      array1[3] = "2023-03-15";
      array1[4] = "2023-04-17";
      array1[5] = "2023-05-18";
      array1[6] = "2023-06-15";
      array1[7] = "2023-07-17";
      array1[8] = "2023-08-15";
      array1[9] = "2023-09-15";
      array1[10] = "2023-10-23";
      array1[11] = "2023-11-15";
      array1[12] = "2023-12-15";
      array1[13] = "Null";

      //出口退税申报期限 -- 外贸企业
      var array2 = new Array();
      array2[0] = "Null";
      array2[1] = "2023-01-31";
      array2[2] = "2023-02-28";
      array2[3] = "2023-03-31";
      array2[4] = "2023-04-30";
      array2[5] = "2023-05-31";
      array2[6] = "2023-06-30";
      array2[7] = "2023-07-31";
      array2[8] = "2023-08-31";
      array2[9] = "2023-09-30";
      array2[10] = "2023-10-31";
      array2[11] = "2023-11-30";
      array2[12] = "2023-12-31";
      array2[13] = "Null";

    //⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳⓪
    //❶❷❸❹❺❻❼❽❾❿⓫⓬⓭⓮⓯⓰⓱⓲⓳⓴

    //js_input1 是否适用政策
    document.querySelector('#js_input1').addEventListener('click', function () {
        weui.picker([{
            label: '是',
            value: '是'
        }, {
            label: '否',
            value: '否'
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                document.getElementById("js_input1").value = result[0].value;

                //影响第6栏
                set_6();
                //影响第8栏
                set_8();
            },
            title: '请选择'
        });
    });

    //开关：是否适用政策
    /*document.querySelector('#checkbox_zc').addEventListener('change', function () {
      //影响第6栏
      set_6();
      //影响第8栏
      set_8();

    });*/

    //企业类型 选择器
    document.querySelector('#js_input2').addEventListener('click', function () {
        weui.picker([{
            label: '生产企业',
            value: '生产企业'
        }, {
            label: '外贸企业',
            value: '外贸企业'
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                document.getElementById("js_input2").value = result[0].value;

                //第2栏变化，会影响第12栏
                set_12();
            },
            title: '企业类型选择'
        });
    });

    //启运日期--点击事件
      document.querySelector('#js_input3').addEventListener('click', function () {
        weui.datePicker({
          start: '2021-01-01',
          end: '2025-12-31',
          /**
           * https://zh.wikipedia.org/wiki/Cron
           * cron 表达式后三位
           * 示例：
           *  * * *                每天
           *  5 * *                每个月的5日
           *  1-10 * *             每个月的前10日
           *  1,5,10 * *           每个月的1号、5号、10号
           *  *\/2 * *             每个月的 1、3、5、7...日，注意写的时候斜杠“/”前面没有反斜杠“\”，这是因为是注释所以需要转义
           *  * 2 0                2月的每个周日
           *  * * 0,6              每个周末
           *  * * 3                每周三   '* *2 0'
           */
          cron: '* * *',
          defaultValue: [2023, 1, 1],
          onChange: function onChange(result) {
            console.log(result);
          },
          onConfirm: function onConfirm(result) {
            console.log(result);
            //weui.alert(result[0].value + "-" + result[1].value + "-" + result[2].value);
            var str = result[0].value + "-" + result[1].value + "-" + result[2].value;
            document.getElementById("js_input3").value = moment(str.replace(/-/g, "/")).format('YYYY-MM-DD');
            
            //关联修改【报关日期】
            //set_6();

            //同步修改【离境日期】  3影响5，5再影响6(在5里面调用6)
            set_5();
            
          },
          id: 'datePicker',
          title: '日期选择器'
        });
      });

    //间隔天数1
    document.querySelector('#js_input4').addEventListener('blur', function () {
      //同步修改【离境日期】
      set_5();
    });

    //
    //间隔天数2
    document.querySelector('#js_input7').addEventListener('blur', function () {
      set_8();
    });


    //设定第6栏【报关日期】
    function set_6() {
      //var sfsyzc = document.getElementById("checkbox_zc").checked; 
      var sfsyzc = document.getElementById("js_input1").value;
      //alert(sfsyzc)
      if (sfsyzc == "是") {
        //适用政策，则报关日期=启运日期
        document.getElementById("js_input6").value = document.querySelector('#js_input3').value;
      } else {
        //否则，报关日期=离境日期
        document.getElementById("js_input6").value = document.querySelector('#js_input5').value;
      }

      //第6栏变化，会影响第9栏
      set_9();

      //第6栏变化，会影响第8栏
      set_8();

      //第6栏变化，会影响第9栏(二次刷新，避免先后更新问题)
      set_9();
    }
    


    //设定第5栏【离境日期】
    function set_5() {
      //获取启运日期
      var str_rq = document.getElementById("js_input3").value;
      var ts1 = document.getElementById("js_input4").value;

      if (str_rq != '' && ts1 != '') {
        var d1 = moment(str_rq).add(ts1, 'days');
        //离境日期
        document.getElementById("js_input5").value = d1.format('YYYY-MM-DD');

        //5会影响6
        set_6();
      }
    }

    //设定第8栏【获取关单电子信息日期】
    function set_8() {
      //获取报关日期
      var str_bgrq = document.getElementById("js_input6").value;
      var ts2 = document.getElementById("js_input7").value;

      if (str_bgrq != '' && ts2 != '') {
        var d1 = moment(str_bgrq).add(ts2, 'days');
        //获取关单电子信息日期
        document.getElementById("js_input8").value = d1.format('YYYY-MM-DD');

        //第8栏变化，会影响第12栏
        set_12();
      }
    }

     //设定第9栏【增值税纳税申报所属期】  同步设置11栏
     function set_9() {
      //获取报关日期
      var str_bgrq = document.getElementById("js_input6").value;
      if (str_bgrq != '') {
        var d1 = moment(str_bgrq);
        //获取关单电子信息日期
        document.getElementById("js_input9").value = d1.format('YYYY-MM');

        //第9栏变化，会影响第11栏【增值税纳税申报期限】
        //所属期 月份
        var SSQND = d1.format('YYYY');
        if(parseInt(SSQND)>2023){
          document.getElementById("js_input11").value = "所输入测算条件超出本工具测算范围";
          console.log("set_9: SSQND = " + SSQND);
          return;
        }

        var SSQYF = d1.format('M');
        //d1.add(1,"months").format('M');
        console.log("set_9: SSQYF = " + SSQYF);
        if(parseInt(SSQYF) >=12){
          //大于等于12月，导到申报期限跨到下一年。
          document.getElementById("js_input11").value = "所输入测算条件超出本工具测算范围";
        }else{
          var n = parseInt(SSQYF) + 1;
          document.getElementById("js_input11").value = array1[n];
        }
        
      }
    }

    //第10栏【单证信息齐全出口货物销售额出口退税申报所属期】-- 由12栏倒推1个月
    function set_10() {
      var value12 = document.getElementById("js_input12").value;
      if(value12 == ""){
        return;
      }

      if(value12 == "所输入测算条件超出本工具测算范围"){
        document.getElementById("js_input10").value = "所输入测算条件超出本工具测算范围";
      }else{
        console.log("set_10: value12 = " + value12);
        document.getElementById("js_input10").value = moment(value12).subtract(1, 'months').format("YYYY-MM");
      }
      
    }

  //第12栏 出口退税申报时限
  function set_12(){
    var value2 = document.getElementById("js_input2").value;
    var value8 = document.getElementById("js_input8").value;
    var value11 = document.getElementById("js_input11").value;
    if(value2 == "" || value8 == ""){
      return;
    }
    console.log("set 12 ");
    //根据企业类型，获取对应出口退税申报期限
    var m = moment(value8).format("M");
    //console.log("m= " + m);
    var cktssbqx = "";
    var value12 = "";

    if(value2 == "生产企业"){
      cktssbqx = array1[m];
      //若【获取关单电子信息日期 （第8栏）】小于或等于【出口退税申报期限 cktssbqx】则第12栏等于 cktssbqx
      //否则，等于 下一个对应的申报期限
      if(value8 <= cktssbqx){
        value12 = cktssbqx;
      }else{
        var n = parseInt(m) + 1;
        //console.log("n=" + n)
        if(n < 13){
          value12 = array1[n];
        }else{
          value12 = "所输入测算条件超出本工具测算范围";
        }
      }
      console.log("生产企业  A  value12=" + value12 + " value11=" + value11);

      //特别注意：value12 必须是大于或等于 value11  否则做二次修正
      if(value12 != "所输入测算条件超出本工具测算范围" && value12 < value11 ){
        console.log("生产企业  value12不能小于value11,修正后：value12=" + value12 + " value11=" + value11);
        value12 = value11;
      }

      document.getElementById("js_input12").value = value12;
      console.log("value12 update ")

    }else if(value2 == "外贸企业"){
      cktssbqx = array2[m];
      //若【获取关单电子信息日期 （第8栏）】小于或等于【出口退税申报期限 cktssbqx】则第12栏等于 cktssbqx
      //否则，等于 下一个对应的申报期限
      if(value8 <= cktssbqx){
        value12 = cktssbqx;
      }else{
        var n = parseInt(m) + 1;
        if(n < 13){
          value12 = array2[n];
        }else{
          value12 = "所输入测算条件超出本工具测算范围";
        }
      }
      console.log("外贸企业  A  value12=" + value12 + " value11=" + value11);
      //特别注意：value12 必须是大于或等于 value11. 否则做二次修正
      if(value12 != "所输入测算条件超出本工具测算范围" && value12 < value11){
        var n = parseInt(m) + 1;
        value12 = array2[n];
        console.log("外贸企业  value12不能小于value11,修正后：value12=" + value12 + " value11=" + value11);
      }
      document.getElementById("js_input12").value = value12;
      //console.log("value12 update ")
    }

    //年度不能超过2023
    var ND = moment(value8).format('YYYY');
    if(parseInt(ND)>2023){
      document.getElementById("js_input12").value = "所输入测算条件超出本工具测算范围";
      console.log("set_12: ND = " + ND);
      
    }

    //同步更新第10栏的值【对应的出口退税申报所属期】
    set_10();
  }


  </script>

</body>

</html>