<!doctype html>
<html lang=zh_CN>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <title>TAX Calculator</title>
  <!-- 引入样式文件 -->
  <link rel=stylesheet href="./res/weui.css">



</head>

<body ontouchstart>

  <div class="page">
    <div class="weui-form">
      <div class="weui-form__text-area">
        <h2 class="weui-form__title">出口企业申报时间测算表</h2>
        <div class="weui-form__desc">（出口企业是否适用启运港退税政策差异对比,2022年征期）</div>
      </div>
      <div class="weui-form__control-area">
        <div class="weui-cells__group weui-cells__group_form">
          <!--<div class="weui-cells__title">标题</div> -->
          <div class="weui-cells">
            <label for="cb" class="weui-cell weui-cell_active weui-cell_switch">
              <div class="weui-cell__bd" id="cb_txt" aria-hidden="true">①是否适用启运港退税政策</div>
              <div class="weui-cell__ft">
                  <input aria-labelledby="cb_txt" id="checkbox_zc" class="weui-switch" type="checkbox" checked="checked"/>
              </div>
            </label>

            <label for="js_input2" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">②企业类型</span></div>
              <div class="weui-cell__bd">
                <input id="js_input2" class="weui-input" placeholder="请选择" />
              </div>
            </label>
            

            <label for="js_input3" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">③启运日期</span>
                <!-- <div class="weui-cell__desc">副标题</div> -->
              </div>
              <div class="weui-cell__bd">
                <input id="js_input3" class="weui-input" placeholder="请选择日期" />
              </div>
            </label>

            <label for="js_input4" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">④启运与离境间隔天数</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input4" class="weui-input" placeholder="请输入数字" type="number" pattern="[0-9]*" />
              </div>
            </label>

            <label for="js_input5" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">⑤离境日期</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input5" class="weui-input" placeholder="点击自动计算 ⑤=③+④" readonly/>
              </div>
            </label>

            <label for="js_input6" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑥报关日期</span>
                <div class="weui-cell__desc">（报关单的</div>
                <div class="weui-cell__desc">“出口日期”）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input6" class="weui-input" placeholder="点击自动计算" readonly />
              </div>
            </label>

            <label for="js_input7" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd"><span class="weui-label">⑦报关与获取关单电子信息间隔天数</span></div>
              <div class="weui-cell__bd">
                  <input id="js_input7" class="weui-input" placeholder="请输入数字" type="number" pattern="[0-9]*" />
              </div>
            </label>

            <label for="js_input8" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑧获取关单电子信息日期</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input8" class="weui-input" placeholder="点击自动计算 ⑧=⑥+⑦" readonly />
              </div>
            </label>

            <label for="js_input9" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑨增值税纳税申报所属期</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input9" class="weui-input" placeholder="自动获取 ⑨=⑥所在月份" readonly />
              </div>
            </label>

            <label for="js_input10" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑩出口退税申报所属期</span>
                <div class="weui-cell__desc">（单证信息齐全）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input10" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

            <label for="js_input11" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑪增值税纳税申报时限</span>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input11" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

            <label for="js_input12" class="weui-cell weui-cell_active">
              <div class="weui-cell__hd">
                <span class="weui-label">⑫出口退税申报时限</span>
                <div class="weui-cell__desc">（最早）</div>
              </div>
              <div class="weui-cell__bd">
                <input id="js_input12" class="weui-input" placeholder="自动计算" readonly />
              </div>
            </label>

          </div>
        </div>
      </div>
      <div class="weui-form__tips-area">
        <p class="weui-form__tips">
          测算结果仅供参考，请以相关文件及当地税务机关申报要求为准。
        </p>
      </div>

      <div class="weui-form__extra-area">
        <div class="weui-footer">
          <p class="weui-footer__links">
            <a href="javascript:history.back()" class="weui-footer__link">返回上一页</a>
          </p>
          <p class="weui-footer__text">Copyright © 2022 南沙税务</p>
        </div>
      </div>
    </div>

  </div>





  <!--<script type="text/javascript" src="./zepto.js"></script> -->
  <script type="text/javascript" src="./res/moment.min.js"></script>
  <script type="text/javascript" src="https://res.wx.qq.com/t/wx_fed/cdn_libs/res/weui/1.2.8/weui.min.js"></script>





  <script>
    

    //出口退税申报期限 -- 生产企业
    var array1 = new Array();
      array1[0] = "Null";
      array1[1] = "2022-01-19";
      array1[2] = "2022-02-23";
      array1[3] = "2022-03-15";
      array1[4] = "2022-04-20";
      array1[5] = "2022-05-19";
      array1[6] = "2022-06-20";
      array1[7] = "2022-07-15";
      array1[8] = "2022-08-15";
      array1[9] = "2022-09-20";
      array1[10] = "2022-10-25";
      array1[11] = "2022-11-15";
      array1[12] = "2022-12-15";
      array1[13] = "Null";

      //出口退税申报期限 -- 外贸企业
      var array2 = new Array();
      array2[0] = "Null";
      array2[1] = "2022-01-31";
      array2[2] = "2022-02-28";
      array2[3] = "2022-03-15";
      array2[4] = "2022-04-30";
      array2[5] = "2022-04-30";
      array2[6] = "2022-06-30";
      array2[7] = "2022-07-31";
      array2[8] = "2022-08-31";
      array2[9] = "2022-09-30";
      array2[10] = "2022-10-31";
      array2[11] = "2022-11-30";
      array2[12] = "2022-12-31";
      array2[13] = "Null";

    //⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳⓪
    //❶❷❸❹❺❻❼❽❾❿⓫⓬⓭⓮⓯⓰⓱⓲⓳⓴
    //开关：是否适用政策
    document.querySelector('#checkbox_zc').addEventListener('change', function () {
      //影响第6栏
      set_6();
      //影响第8栏
      set_8();

    });

    //企业类型 选择器
    document.querySelector('#js_input2').addEventListener('click', function () {
        weui.picker([{
            label: '生产企业',
            value: '生产企业'
        }, {
            label: '外贸企业',
            value: '外贸企业'
        }], {
            onChange: function (result) {
                console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                document.getElementById("js_input2").value = result[0].value;

                //第2栏变化，会影响第12栏
                set_12();
            },
            title: '企业类型选择'
        });
    });

    //启运日期--点击事件
      document.querySelector('#js_input3').addEventListener('click', function () {
        weui.datePicker({
          start: '2021-01-01',
          end: '2025-12-31',
          /**
           * https://zh.wikipedia.org/wiki/Cron
           * cron 表达式后三位
           * 示例：
           *  * * *                每天
           *  5 * *                每个月的5日
           *  1-10 * *             每个月的前10日
           *  1,5,10 * *           每个月的1号、5号、10号
           *  *\/2 * *             每个月的 1、3、5、7...日，注意写的时候斜杠“/”前面没有反斜杠“\”，这是因为是注释所以需要转义
           *  * 2 0                2月的每个周日
           *  * * 0,6              每个周末
           *  * * 3                每周三   '* *2 0'
           */
          cron: '* * *',
          defaultValue: [2022, 1, 1],
          onChange: function onChange(result) {
            console.log(result);
          },
          onConfirm: function onConfirm(result) {
            console.log(result);
            //weui.alert(result[0].value + "-" + result[1].value + "-" + result[2].value);
            var str = result[0].value + "-" + result[1].value + "-" + result[2].value;
            document.getElementById("js_input3").value = moment(str.replace(/-/g, "/")).format('YYYY-MM-DD');
            
            //关联修改【报关日期】
            //set_6();

            //同步修改【离境日期】  3影响5，5再影响6(在5里面调用6)
            set_5();
            
          },
          id: 'datePicker',
          title: '日期选择器'
        });
      });

    //间隔天数1
    document.querySelector('#js_input4').addEventListener('blur', function () {
      //同步修改【离境日期】
      set_5();
    });

    //
    //间隔天数2
    document.querySelector('#js_input7').addEventListener('blur', function () {
      set_8();
    });


    //设定第6栏【报关日期】
    function set_6() {
      var sfsyzc = document.getElementById("checkbox_zc").checked;
      if (sfsyzc == true) {
        //适用政策，则报关日期=启运日期
        document.getElementById("js_input6").value = document.querySelector('#js_input3').value;
      } else {
        //否则，报关日期=离境日期
        document.getElementById("js_input6").value = document.querySelector('#js_input5').value;
      }

      //第6栏变化，会影响第9栏
      set_9();

      //第6栏变化，会影响第8栏
      set_8();

      //第6栏变化，会影响第9栏(二次刷新，避免先后更新问题)
      set_9();
    }
    


    //设定第5栏【离境日期】
    function set_5() {
      //获取启运日期
      var str_rq = document.getElementById("js_input3").value;
      var ts1 = document.getElementById("js_input4").value;

      if (str_rq != '' && ts1 != '') {
        var d1 = moment(str_rq).add(ts1, 'days');
        //离境日期
        document.getElementById("js_input5").value = d1.format('YYYY-MM-DD');

        //5会影响6
        set_6();
      }
    }

    //设定第8栏【获取关单电子信息日期】
    function set_8() {
      //获取报关日期
      var str_bgrq = document.getElementById("js_input6").value;
      var ts2 = document.getElementById("js_input7").value;

      if (str_bgrq != '' && ts2 != '') {
        var d1 = moment(str_bgrq).add(ts2, 'days');
        //获取关单电子信息日期
        document.getElementById("js_input8").value = d1.format('YYYY-MM-DD');

        //第8栏变化，会影响第12栏
        set_12();
      }
    }

     //设定第9栏【增值税纳税申报所属期】
     function set_9() {
      //获取报关日期
      var str_bgrq = document.getElementById("js_input6").value;
      if (str_bgrq != '') {
        var d1 = moment(str_bgrq);
        //获取关单电子信息日期
        document.getElementById("js_input9").value = d1.format('YYYY-MM');

        //第9栏变化，会影响第11栏【增值税纳税申报期限】
        //var v9 = document.getElementById("js_input9").value;
        document.getElementById("js_input11").value = array1[d1.add(1,"months").format('M')];
      }
    }

    //第10栏【单证信息齐全出口货物销售额出口退税申报所属期】-- 由12栏倒推1个月
    function set_10() {
      var value12 = document.getElementById("js_input12").value;
      if(value12 == ""){
        return;
      }
      
      document.getElementById("js_input10").value = moment(value12).subtract(1, 'months').format("YYYY-MM");
    }

  //第12栏 出口退税申报时限
  function set_12(){
    var value2 = document.getElementById("js_input2").value;
    var value8 = document.getElementById("js_input8").value;
    var value11 = document.getElementById("js_input11").value;
    if(value2 == "" || value8 == ""){
      return;
    }
    console.log("set 12 ");
    //根据企业类型，获取对应出口退税申报期限
    var m = moment(value8).format("M");
    //console.log("m= " + m);
    var cktssbqx = "";
    var value12 = "";

    if(value2 == "生产企业"){
      cktssbqx = array1[m];
      //若【获取关单电子信息日期 （第8栏）】小于或等于【出口退税申报期限 cktssbqx】则第12栏等于 cktssbqx
      //否则，等于 下一个对应的申报期限
      if(value8 <= cktssbqx){
        value12 = cktssbqx;
      }else{
        var n = parseInt(m) + 1;
        //console.log("n=" + n)
        value12 = array1[n];
        //console.log("value12=" + value12)
      }
      console.log("A  value12=" + value12 + " value11=" + value11);
      //特别注意：value12 必须是大于或等于 value11
      if(value12 < value11){
        console.log("B  value12=" + value12 + " value11=" + value11);
        value12 = value11;
      }
      document.getElementById("js_input12").value = value12;
      console.log("value12 update ")

    }else if(value2 == "外贸企业"){
      cktssbqx = array2[m];
      //若【获取关单电子信息日期 （第8栏）】小于或等于【出口退税申报期限 cktssbqx】则第12栏等于 cktssbqx
      //否则，等于 下一个对应的申报期限
      if(value8 <= cktssbqx){
        value12 = cktssbqx;
      }else{
        var n = parseInt(m) + 1;
        value12 = array2[n];
      }
      console.log("A  value12=" + value12 + " value11=" + value11);
      //特别注意：value12 必须是大于或等于 value11. 否则做二次修正
      if(value12 < value11){
        console.log("B  value12=" + value12 + " value11=" + value11);
        var n = parseInt(m) + 1;
        value12 = array2[n];
      }
      document.getElementById("js_input12").value = value12;
      console.log("value12 update ")

    }

    //同步更新第10栏的值【对应的出口退税申报所属期】
    set_10();
  }


  </script>

</body>

</html>